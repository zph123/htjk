<!--jQuery mobile时间控件支持-->
<link href="__PUBLIC__/static/css/data/animate.css" type="text/css" rel="stylesheet"><!--动画库---css-->
<script src="__PUBLIC__/static/css/data/mobiscroll_002.js" type="text/javascript"></script>
<script src="__PUBLIC__/static/css/data/mobiscroll_004.js" type="text/javascript"></script>
<link href="__PUBLIC__/static/css/data/mobiscroll_002.css" rel="stylesheet" type="text/css">
<link href="__PUBLIC__/static/css/data/mobiscroll.css" rel="stylesheet" type="text/css">
<script src="__PUBLIC__/static/css/data/mobiscroll.js" type="text/javascript"></script>
<script src="__PUBLIC__/static/css/data/mobiscroll_003.js" type="text/javascript"></script>
<script src="__PUBLIC__/static/css/data/mobiscroll_005.js" type="text/javascript"></script>
<link href="__PUBLIC__/static/css/data/mobiscroll_003.css" rel="stylesheet" type="text/css">
<script src="__PUBLIC__/static/css/data/data.js" type="text/javascript"></script>


<!--上传图片支持-->
<script src="__PUBLIC__/static/js/fileinput.js" type="text/javascript"></script>
<script src="__PUBLIC__/static/js/fileinput_locale_zh.js" type="text/javascript"></script>
<link rel="stylesheet" type="text/css" href="__PUBLIC__/static/css/default.css">
<link href="__PUBLIC__/static/css/fileinput.css" media="all" rel="stylesheet" type="text/css" />


</head>
<body>
<div data-role="header">
    <h1>在线测试（现处于测试阶段，正则验证已暂时禁用）</h1>
</div>

<div data-role="content"  style="margin-bottom:10%;" id="content">
    <form data-ajax="false" method="post" id="form_onlinetest" name="form_onlinetest" enctype="multipart/form-data" action="{:url('index/test/add_onlinetest')}">
        <p id="name_price">{$price.p_name}</p>

        <p>现价：
            <font color="red">￥
                <i id="present_price">{$price.p_price}</i>
            </font>
            元/人次
        </p>
        <div class="ui-field-contain">
            <label for="predict_height">预测身高:</label>
            <select name="predict_height" id="predict_height" data-role="flipswitch">
                <option value="0">不要</option>
                <option value="1">要</option>
            </select>
            <font style="color: red;display: none" name="premium">预测身高需要 <span name="add_price"></span>元</font>
        </div>
        <ul data-role="listview" data-inset="true">
            <li data-role="list-divider">
                请先选择性别 <font color="red">• 必填</font>
            </li>
        </ul>
        <div class="ui-field-contain" id="opt-navbars">
            <fieldset data-role="controlgroup" data-type="horizontal">
                <legend></legend>
                <label for="show">♂ 男</label>
                <input type="radio" name="gender" id="show" value="1" checked>
                <label for="hide">♀ 女</label>
                <input type="radio" name="gender" id="hide" value="0">
            </fieldset>
        </div>
        <ul data-role="listview" data-inset="true">
            <li data-role="list-divider">
                请录入测试人信息 <font color="red">• 必填</font>
            </li>
        </ul>
        <div class="ui-field-contain">
            <fieldset data-role="fieldcontain" id="fieldcontain">

                <label for="customer"><font color="red">• </font>测试人姓名:</label>
                <input type="text" name="customer" id="customer" value="" data-clear-btn="true">

                <label for="appDate"><font color="red">• </font>出生日期:</label>
                <input name="appDate" id="appDate" value="2016-10-31" readonly="readonly" type="text">

                <label for="id_number"><font color="red">• </font>身份证号:</label>
                <input type="text" name="id_number" id="id_number" value="" data-clear-btn="true">

                <label for="age" class="select"><font color="red">• </font>测试人年龄:</label>
                <select name="age" id="age" data-native-menu="false">
                    <optgroup label="年龄">
                        {for start="1" end="90"  }
                        <option value="1">{$i}岁</option>
                        {/for}
                    </optgroup>
                </select>

                <label for="birth_height"><font color="red">• </font>出生时身高:</label>
                <input type="text" name="birth_height" id="birth_height" value="" data-clear-btn="true" placeholder="单位：/cm">

                <label for="birth_weight"><font color="red">• </font>出生时体重:</label>
                <input type="text" name="birth_weight" id="birth_weight" value="" data-clear-btn="true" placeholder="单位：/kg">
                <label for="birth_smoothly"><font color="red">• </font>测试人是否为顺产出生:</label>
                <select name="birth_smoothly" id="birth_smoothly" data-role="flipswitch">
                    <option value="1">是</option>
                    <option value="0">否</option>
                </select>

            </fieldset>
        </div>
        <div class="ui-field-contain" id="spermatorrhea_div">
            <label for="spermatorrhea"><font color="red">• </font>测试人是否已遗精:</label>
            <select name="spermatorrhea" id="spermatorrhea" data-role="flipswitch">
                <option value="0">否</option>
                <option value="1">是</option>
            </select>
        </div>

        <div class="ui-field-contain" id="menarche_div">
            <label for="menarche"><font color="red">• </font>测试人是否已初潮:</label>
            <select name="menarche" id="menarche" data-role="flipswitch">
                <option value="0">否</option>
                <option value="1">是</option>
            </select>
        </div>
        <ul data-role="listview" data-inset="true">
            <li data-role="list-divider">
                测试人图片 <font color="red">• 必填</font>
            </li>
        </ul>
        <div class="ui-field-contain">
            <label for="hands_photo"><font color="red">• </font>手部X光片上传:</label>
            <input id="hands_photo" name="hands_photo" class="file" type="file" multiple data-min-file-count="1">
        </div>
        <ul data-role="listview" data-inset="true">
            <li data-role="list-divider">
                其他信息 <font color="red">• 必填</font>
            </li>
        </ul>
        <div class="ui-field-contain">
            <label for="contact_phone"><font color="red">• </font>手机:</label>
            <input type="text" name="contact_phone" id="contact_phone" value="" data-clear-btn="true">
            <label for="email"><font color="red">• </font>邮箱:</label>
            <input type="text" name="email" id="email" value="" data-clear-btn="true">
            <label for="contact_address"><font color="red">• </font>联系地址:</label>
            <input type="text" name="contact_address" id="contact_address" value="" data-clear-btn="true">
            <label for="father_height"><font color="red">• </font>父亲身高:</label>
            <input type="text" name="father_height" id="father_height" value="" data-clear-btn="true" placeholder="单位：/cm">
            <label for="mother_height"><font color="red">• </font>母亲身高:</label>
            <input type="text" name="mother_height" id="mother_height" value="" data-clear-btn="true" placeholder="单位：/cm">
        </div>

        <div class="ui-field-contain">
            <label for="need_report"><font color="red">• </font>纸质报告:</label>
            <select name="need_report" id="need_report" data-role="flipswitch">
                <option value="0">不要</option>
                <option value="1">要</option>
            </select>
        </div>
        <ul data-role="listview" data-inset="true">
            <li data-role="list-divider">
                学校
            </li>
        </ul>
        <div class="ui-field-contain">
            <label for="school"><font color="red">• </font>测试人所属学校:</label>
            <input type="text" name="school" id="school" value="" data-clear-btn="true">
        </div>
        <div data-role="navbar" class="ui-content" id="content_bottom">
            <ul>
                <li></li>
                <li><a class="ui-btn ui-btn-inline ui-shadow ui-corner-all" href="javascript:document.form_onlinetest.reset()" data-rel="dialog">取消</a></li>
                <li></li>
                <li><a class="ui-btn ui-btn-inline ui-shadow ui-corner-all" href="javascript:void (0)" data-rel="dialog" id="form_submit">确认</a></li>
                <li></li>
            </ul>
        </div>


    </form>
</div>


<script>
    $(function () {
        //根据性别变化表单
        $( "#spermatorrhea_div" ).show();
        $( "#menarche_div" ).hide();
        //判断用户是否以及登录
        $.ajax({
            url:"{:url('index/test/ajax_login_status')}",
            type:'get',
            success:function (status) {
                if(status==0){
                    $('#content_bottom').hide();

                    $(".ui-field-contain div").addClass("ui-state-disabled","mobile-flipswitch-disabled");
                    $(".ui-field-contain a").attr("disabled","disabled");
                    $(".ui-field-contain input").attr("disabled","disabled");
                    $(".ui-field-contain select").attr("disabled","disabled");
                    $("#content div").on("click",function () {
                        login_confirm();
                    });
                    login_confirm();

//                    $("#content div").addClass("ui-state-disabled","mobile-flipswitch-disabled");
                    //根据点击变化价格

                }
            },
            error:function () {
                alert('异常，连接失败！')
            }
        });

        //根据性别变化
        $( "#opt-navbars input" ).on( "change", function( event ) {
            if ( $( "#show" ).prop( "checked" ) ) {
                $( "#spermatorrhea_div" ).show();
                $( "#menarche_div" ).hide();
            } else if ( $( "#hide" ).prop( "checked" ) ) {
                $( "#spermatorrhea_div" ).hide();
                $( "#menarche_div" ).show();
            }
        });

        //根据 “预测身高” 变化
        $('#predict_height').on('change',function() {
            //获取select的值
            var predict_height=$('#predict_height').val();
            //筛选出 premium对象（加价）
            var premium=$("font[name='premium']");

            $.ajax({
                url:"{:url('index/test/ajax_price')}",
                data:{predict_height:predict_height},
                type:"get",
                dataType:'json',
                success:function (price_arr) {
                    $("#name_price").html(price_arr.p_name);
                    $("#present_price").html(price_arr.p_price);
                },
                error:function () {
                    alert('异常，连接失败！')
                }
            });
        });

        //提交
        $('#form_submit').click(function () {
            autosubmit();
        })
    });

    //jQuery Mobile  的confirm ----- #popupDialog
    //引用入 on 时报错-----失败！
    function jq_m_confirm() {
        $("a[href='#popupDialog']").click()
    }
    //确认取消
    function login_confirm(){
        var r=confirm("您还没登录，请前往登录！")
        if (r==true)
            location.href="{:url('index/login/index')}"
//        else location.href="{:url('index/index/index')}"
    }

    /**
     * 检测数据和提交
     */
    function autosubmit() {
        var status=1;

//        //姓名
//        if(!$('#customer').val()){
//            status=0;
//            alert('测试人姓名不能为空。');
//            return
//        }
//        //身份证号
//        var reg_ident=/^\d{18}|\d{17}x$/i;
//        if(!reg_ident.test($('#id_number').val())){
//            status=0;
//            alert('身份证号有误！');
//            return
//        }
//        //身高
//        var birth_height=$('#birth_height').val();
//        if(
//                isNaN(Number(birth_height))
//                ||birth_height<=0
//                ||birth_height>100
//        ){
//            status=0;
//            alert('出生身高错误！');
//            return
//        }
//        //体重
//        var birth_weight=$('#birth_weight').val();
//        if(
//                isNaN(Number(birth_weight))
//                ||birth_weight<=0
//                ||birth_weight>20
//        ){
//            status=0;
//            alert('出生体重错误！');
//            return
//        }
//        //手机号
//        var reg_phone=/^1[3,5,8]\d{9}$/;
//        if(!reg_phone.test($('#contact_phone').val())){
//            status=0;
//            alert('手机号错误。');
//            return
//        }
//        //邮箱
//        var reg_emaile=/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(.[a-zA-Z0-9_-])+/;
//        if(!reg_emaile.test($('#email').val())){
//            status=0;
//            alert('邮箱错误。');
//            return
//        }
//        //联系地址
//        if(!$('#contact_address').val()){
//            status=0;
//            alert('联系地址不能为空。');
//            return
//        }
//        //父亲身高
//        var father_height=$('#father_height').val();
//        if(
//                isNaN(Number(father_height))
//                ||father_height<=0
//                ||father_height>100
//        ){
//            status=0;
//            alert('父亲身高错误！');
//            return
//        }
//        //母亲身高
//        var mother_height=$('#mother_height').val();
//        if(
//                isNaN(Number(mother_height))
//                ||mother_height<=0
//                ||mother_height>100
//        ){
//            status=0;
//            alert('母亲身高错误！');
//            return
//        }
//        //所在学校
//        if(!$('#school').val()){
//            status=0;
//            alert('请填写测试人所在学校。');
//            return
//        }

        if(status){
            var form=$('#form_onlinetest');
            form.submit();
        }
    }
</script>
